services:
  unifi:
    profiles: ["unifi"]
    image: jacobalberty/unifi:v8.6
    container_name: unifi
    restart: unless-stopped
    networks: [frontend]
    env_file:
      - ../.env
    environment:
      - TZ=Europe/Stockholm
    healthcheck:
      test: ["CMD", "curl", "-kfs", "https://localhost:8443/status"]
      interval: 30s
      timeout: 10s
      retries: 5
    ports:
      # Device communication (must be exposed directly, not through reverse proxy)
      - "3478:3478/udp"   # STUN
      - "10001:10001/udp" # Device discovery
      - "8080:8080"       # Device inform
    volumes:
      - ${DATA_DIR}/unifi/data:/unifi
